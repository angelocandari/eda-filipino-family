---
title: "Typical Filipino"
output: 
  html_document:
    keep_md: true
    theme: spacelab
    highlight: monochrome
    css: style.css
---

# Introduction
Filipinos are cheerful, resourceful and practical people. It is in our nature to make
the best out a of a situation, no matter how hard it is, and still manage to smile
while talking about it. We get this from our strong family values and religious beliefs.
However, our ideals are not always represented in our actions specially when it comes
to our financial priorities. I would always hear stories of parents working abroad for
10 to 20 years and coming back to their families poorer than they were before they left.

## Objectives
In this article, I would like to uncover the spending habits and financial priorities of
a typical Filipino family and try to understand why Filipinos with good paying jobs 
are still poor. 

## Dataset Source
This dataset is from The Philippine Statistics Authority who conducts the Family Income
and Expediture Survey (FEIS) every 3 years nationwide. This is from the most recent 
survey 2015. The raw data was cleaned by Francis Paul Flores from his
[kaggle.com/grosvenpaul](https://www.kaggle.com/grosvenpaul/datasets).

# Getting a Feel of the Data
The Dataset contains 41,544 observations of Filipino Households from every Region of
the country. It is comprised of 60 variables describing each family on their income,
family description and expenditure.

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(readr)

fies <- read_csv("fies.csv")

# Rename Lables for easier reference.
names(fies) <- c("income", "region", "expense", "source", 
                 "agri_house", "exp_bread", "exp_rice", "exp_meat", 
                 "exp_seafood", "exp_fruit", "exp_veg", "exp_resto_hotel", 
                 "exp_alcoh", "exp_taba", "exp_clothe", "exp_house_water", 
                 "exp_rent", "exp_med", "exp_trans", "exp_comms", 
                 "exp_edu", "exp_misc", "exp_spec", "exp_farm",
                 "inc_entrep", "head_gender", "head_age", "head_stat", 
                 "head_educ", "head_job_bus", "head_occup", "head_workclass", 
                 "family_t", "family_n", "kids_n", "young_n", 
                 "employed_n", "house_t", "roof_t", "wall_t", 
                 "house_area", "house_age", "bed_n", "house_tenure",
                 "toilet", "electric", "water_t", "tv_n", 
                 "DVD_n", "sterio_n", "ref_n", "wash_n", 
                 "aircon_n", "car_n", "tel_n", "cell_n",
                 "pc_n", "stove_n", "mboat_n", "mbike_n")
```

There are 60 variables in this dataset and are not code friendly. First thing to do is
rename each column key. In the interest of exploration, I will keep each column and 
describe them as I go through this analysis. A detailed desciption of each column is 
documented on a separate txt file for your reference.

```{r}
names(fies)
```


## Income Distribution

```{r message=FALSE, warning=FALSE}
library(ggplot2)

ggplot(fies, aes(income)) +
  geom_histogram()

```
It comes to no surprise that income per household is skewed to the left, where there is more
poor families and few rich people with dramatic outlying incomes.

```{r}
summary(fies$income)
```
Doing a quick summary of the income, we see that the average income of each household is
247,556 Php annually. But this is skewed because of the maximum income of 11 mill Php of
the super rich.


```{r message=FALSE, warning=TRUE}
library(scales)
set.seed(222)
fies_sam <- fies[sample(nrow(fies), 10000), ]
ggplot(fies_sam, aes(income)) +
  geom_histogram() +
  scale_x_continuous(trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                150000, 400000, 
                                1000000, 2000000))
```

We transform the histogram to adjust the power of magnitude of each income and as a result
we can see a beautiful normal distribution. This tells us that even though the distribution
of the linear graph is long-tailed because of the ultra rich, the log scale allows us to
see the underlying data that distribution of income is pretty normal and that it only
differs on how much people are earning. And so this is why the median is a better
measure of center than the mean because the median is not heavily influenced by the outliers.

The Rich are really rich at 11 mill Php annual income and the Poor are really poor with
only 11,285 Php but the average Filipino would roughly earn around 150,000 Php.

```{r}
fies$head_occup <- factor(fies$head_occup)
fies$head_workclass <-factor(fies$head_workclass)

ggplot(fies, aes(income)) +
  geom_histogram() +
  scale_x_continuous(
                     trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                150000, 400000, 
                                1000000, 2000000)) +
  facet_wrap(~ head_workclass)
```



```{r}
library(stringr)
library(dplyr)

professionals_class <- paste(c("manag", "medical", "dentist", "sales", "lawyer", "architect", "supervisor",
                         "principals", "trade", "education", "chemist", "scientist", "justice", 
                         "engineer", "director", "accountant", "secretaries", 
                         "therapist", "opticians", "Veter"), collapse = "|")

farmer_class <- paste(c("farm", "fish", "growers", "gather", "raiser", "cultivat", 
                        "plant", "hunter", "village"), collapse = "|")

worker_class <- paste(c("workers", "carpenters", "welder", "helper", "clean", "launder", "tailor", "labor", 
                        "driver", "electr", "technician", "freight", "mason", "porter", "waiter", "cook", 
                        "clerk", "operator", "mechanic", "foremen", "caretaker","lineman", "varnish", 
                        "conductor", "bookkeeper", "transport", "inspector", "agent", "undertaker", 
                        "insurance", "healers", "loggers", "wood", "roofers", "cutter", "assembler", 
                        "builder", "metal", "assistant", "tanners", "garbage", "repair", "prepare", 
                        "rigger", "practitioners"), collapse = "|")

merchant_class <- paste(c("vendors", "pawn", "buy", "baker", "maker"), collapse = "|")

artist_class <- paste(c("designer", "artists", "singers", "television", "dancer", "fashion"), collapse = "|")

fies$head_occup_class <- with(fies,
                              ifelse(str_detect(head_workclass, "government"), "government",
                              ifelse(grepl(worker_class, head_occup, ignore.case = T), "workers",
                              ifelse(grepl(professionals_class, head_occup, ignore.case = T), "professionals",
                              ifelse(grepl(farmer_class, head_occup, ignore.case = T), "farmers",
                              ifelse(grepl(merchant_class, head_occup, ignore.case = T), "merchant",
                              ifelse(grepl(artist_class, head_occup, ignore.case = T), "arts",
                              NA)))))))

fies.occup <- fies %>%
  filter(is.na(fies$head_occup_class)) %>%
  group_by(head_occup, head_workclass) %>%
  summarise(n= n(),
            income_mean = mean(income),
            income_median = median(income)) %>%
  arrange(desc(n), head_workclass)

fies.occup
```
```{r}
tapply(fies$income, fies$head_occup_class, summary)

fies.professionals <- fies %>%
  filter(fies$head_occup_class == "professionals") %>%
  group_by(head_occup) %>%
  summarise(income_mean = mean(income),
            income_median = median(income),
            n= n()) %>%
  arrange(desc(income_mean))

fies.professionals
```

```{r}
fies.workers <- fies %>%
  filter(fies$head_occup_class == "workers") %>%
  group_by(head_occup) %>%
  select(head_occup, income) %>%
  arrange(desc(income), head_occup)

fies.workers

subset(fies, income == 5652261)
```


```{r}
ggplot(fies, aes(income)) +
  geom_histogram() +
  scale_x_continuous(
                     trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                150000, 400000, 
                                1000000, 2000000)) +
  facet_wrap( ~ head_occup_class)
```

```{r}
ggplot(fies, aes(income)) +
  geom_histogram() +
  facet_wrap(~ head_educ)
```

