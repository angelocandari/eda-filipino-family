---
title: "Typical Filipino"
output: 
  html_document:
    keep_md: true
    theme: spacelab
    highlight: monochrome
    css: style.css
---

# Introduction
Filipinos are cheerful, resourceful and practical people. It is in our nature to make
the best out a of any situation, no matter how hard it is. We get this from our strong 
family values and religious beliefs. However, our ideals are not always represented in 
our actions specially when it comes to our financial priorities. I would always hear 
stories of parents working abroad for 10 to 20 years and coming back to their families 
poorer than they were before they left.

## Objectives
In this article, I would like to find out  if the spending habits and financial priorities 
change as thier income increases of a typical Filipino family.

## Dataset Source
This dataset is from The Philippine Statistics Authority who conducts the Family Income
and Expediture Survey (FEIS) every 3 years nationwide. This is from the most recent 
survey 2015. The raw data was cleaned by Francis Paul Flores from his
[kaggle.com/grosvenpaul](https://www.kaggle.com/grosvenpaul/family-income-and-expenditure/downloads/Family%20Income%20and%20Expenditure.csv).

# Getting a Feel of the Data
The Dataset contains 41,544 observations of Filipino Households from every Region of
the country. It is comprised of 60 variables describing each family on their income,
family description and expenditure.

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(readr)

fies <- read_csv("fies.csv")

# Rename Lables for easier reference.
names(fies) <- c("income", "region", "expense", "source", 
                 "agri_house", "exp_bread", "exp_rice", "exp_meat", 
                 "exp_seafood", "exp_fruit", "exp_veg", "exp_resto_hotel", 
                 "exp_alcoh", "exp_taba", "exp_clothe", "exp_house_water", 
                 "exp_rent", "exp_med", "exp_trans", "exp_comms", 
                 "exp_edu", "exp_misc", "exp_spec", "exp_farm",
                 "inc_entrep", "head_gender", "head_age", "head_stat", 
                 "head_educ", "head_job_bus", "head_occup", "head_workclass", 
                 "family_t", "family_n", "kids_n", "young_n", 
                 "employed_n", "house_t", "roof_t", "wall_t", 
                 "house_area", "house_age", "bed_n", "house_tenure",
                 "toilet", "electric", "water_t", "tv_n", 
                 "DVD_n", "sterio_n", "ref_n", "wash_n", 
                 "aircon_n", "car_n", "tel_n", "cell_n",
                 "pc_n", "stove_n", "mboat_n", "mbike_n")
```

There are 60 variables in this dataset and are not code-friendly. First thing to do is
rename each column key. A detailed desciption of each column is documented on a separate 
txt file for your reference.

```{r}
names(fies)
```


## Income Distribution

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)

ggplot(fies, aes(income)) +
  geom_histogram()

```

It comes to no surprise that income per household is skewed to the left, where there is more
poor families and few rich people with dramatic outlying incomes.

```{r}
summary(fies$income)
```

Doing a quick summary of the income, we see that the average income of each household is
247,556 Php annually. But this is skewed because of the maximum income of 11 mill Php of
the super rich.

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(scales)
set.seed(222)
fies_sam <- fies[sample(nrow(fies), 10000), ]
ggplot(fies_sam, aes(income)) +
  geom_histogram() +
  scale_x_continuous(trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                150000, 400000, 
                                1000000, 2000000))
```

We transform the histogram to adjust the power of magnitude of each income and as a result
we can see a beautiful normal distribution. This tells us that even though the distribution
of the linear graph is long-tailed, the distribution of income is pretty normal and that it
only differs on how much people are earning.

The Rich are really rich at 11 mill Php  and the Poor are really poor with only 11,285 Php 
of annual income. The average Filipino would roughly earn around 150,000 Php.

This graph are showing averages and are not really telling a story. So, we facet the graph
according to different groups or work classes.

```{r echo=FALSE, message=FALSE, warning=FALSE}
fies$head_occup <- factor(fies$head_occup)
fies$head_workclass <- factor(fies$head_workclass)

ggplot(fies, aes(income)) +
  geom_histogram() +
  scale_x_continuous(
                     trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                150000, 400000, 
                                1000000, 2000000)) +
  facet_wrap(~ head_workclass)
```

But this is not really telling us anything especially that the categories are vague and 
are not familiar. The needs a little bit of cleaning.

```{r message=FALSE, warning=FALSE}
library(stringr)
library(dplyr)

professionals_class <- paste(c("managers", "medical", "dentist", "lawyer", "architect",
                               "supervisor", "trade", "education", "chemist", "professionals",
                               "scientist", "justice", "Mechanical engineers", "director", 
                               "accountant", "Chemical engineers", "Electrical Engineers",
                               "Industrial engineers", "designer", "singers", "television", 
                               "dancer", "fashion", "marketing", "Civil engineers", "air",
                               "Computer programmers", "nurse", "Librarians", "science",
                               "therapist", "opticians", "Veter", "pilots", "estate agents",
                               "plant operators"),
                             collapse = "|")

farmer_class <- paste(c("farm", "fish", "growers", "gather", "raiser", "cultivat", 
                        "plant", "hunter", "village", "practitioners", "healers"), 
                      collapse = "|")

worker_class <- paste(c("workers", "carpenters", "welder", "helper", "clean", "launder",
                        "labor", "driver", "freight", "mechanics",
                        "mason", "porter", "waiter", "cook", "foremen", "caretaker", 
                        "lineman", "varnish", "conductor", "salesperson",
                        "bookkeeper", "inspector", "undertaker", 
                        "loggers", "wood", "roofers", "cutter", "electricians",
                        "assembler", "builder", "metal",  "tanners", "garbage",
                        "repair", "prepare", "rigger", "vendors"), 
                      collapse = "|")

office_class <- paste(c("pawn", "buy", "baker", "maker", "tailor", "assistant", "clerk",
                        "engineering technicians", "operators",
                        "artists", "managers/managing proprietors",
                        "educ", "principals", "secretaries", "general"), 
                        collapse = "|")

fies$head_occup_class <- with(fies,
                              ifelse(str_detect(head_workclass, "government"), "government",
                              ifelse(grepl(worker_class, head_occup, ignore.case = T),
                                     "workers",
                              ifelse(grepl(office_class, head_occup, ignore.case = T),
                                     "office",
                              ifelse(grepl(professionals_class, head_occup, ignore.case = T),
                                     "professionals",
                              ifelse(grepl(farmer_class, head_occup, ignore.case = T),
                                     "farmers",
                              NA))))))

fies.occup <- fies %>%
  filter(is.na(fies$head_occup_class)) %>%
  group_by(head_occup) %>%
  summarise(n= n(),
            income_mean = mean(income),
            income_median = median(income)) %>%
  arrange(desc(n))

fies.occup
```

I decided to evaluate each occupation of the head of the family and manually 
group each household according to the following working class:

- *Professionals.* Jobs that usually requires higher education.
- *Farmers.* Jobs that pertains to rural work. Agriculture, Fishing, Husbandry, etc.
- *Workers.* Jobs that usually low paying. Does not require a full degree. Services.
- *Government.* Jobs in government.
- *Office* Usually found in shops and offices of goods.

I am basing the categories based on my own classifications of how I see the working
class and their overall mean income of each working class.


```{r}
tapply(fies$income, fies$head_occup_class, summary)
```

I review each working class and see what I can further refine. My goal is to
segment as much as I can to emphasize the division among the working classes
and at the same time being fair with my evaluation of the different jobs.

```{r message=FALSE, warning=FALSE}
fies.workers <- fies %>%
  filter(fies$head_occup_class == "workers") %>%
  group_by(head_occup) %>%
  select(head_occup, income) %>%
  arrange(desc(income), head_occup)

fies.workers

subset(fies, income == 5652261)
```

I then checked the worker class and noticed some interesting outliers in the group.
The one that stood out is a Waiter job who is earning Php5,652,261 annually. This
does not seem right to me and I took a deeper look and found out that income is the
income including the businesses that they own and not the salaries of that occupation.
Subtracting the income from business from the total income, the Waiter was actually 
earning Php544,810 annually from his job and Php5,107,451 from his business.

```{r}
fies$inc_work <- with(fies, income - inc_entrep)

head(table(sort(fies$inc_work)))
```

```{r}
tapply(fies$inc_work, fies$head_occup_class, summary)
```

```{r}
fies.professionals <- fies %>%
  filter(fies$head_occup_class == "professionals") %>%
  group_by(head_occup) %>%
  summarise(income_mean = mean(inc_work),
            income_median = median(inc_work),
            n= n()) %>%
  arrange(desc(income_mean))

fies.professionals
```

```{r}
fies.office <- fies %>%
  filter(fies$head_occup_class == "office") %>%
  group_by(head_occup) %>%
  summarise(income_mean = mean(inc_work),
            income_median = median(inc_work),
            n= n()) %>%
  arrange(desc(income_mean))

fies.office
```

```{r}
fies.occup <- fies %>%
  filter(is.na(fies$head_occup_class)) %>%
  group_by(head_occup) %>%
  summarise(n= n(),
            income_mean = mean(inc_work),
            income_median = median(inc_work)) %>%
  arrange(desc(n), desc(income_median))

fies.occup
```

I reviewed the professionals group according to income from work and found that General
Managers are getting below average income from salaries. 

Once I knew this, I added a column for income from their jobs. I took a summary to make 
sure that there is no work income that is negative,

```{r}
ggplot(subset(fies, inc_work != 0 & 
                !is.na(head_occup_class)), 
       aes(inc_work)) +
  geom_histogram(col=I("white")) +
  scale_x_continuous(
                     trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                200000, 
                                500000, 2000000),
                     limits = c(2000, 2500000)) +
  facet_wrap( ~ head_occup_class, ncol = 2)

#summary(fies$inc_work)

```

We plot the new organized data according to their respective categories. We can see that
professionals are far to the left with a smaller frequncy. Worker class would have the 
greater count and has a mean closer to the population mean. 

```{r}
fies$head_occup_class <- factor(fies$head_occup_class)
fies$head_occup_class <- ordered(fies$head_occup_class, 
                                 levels = c("professionals", "government", 
                                            "office", "farmers", "workers"))

ggplot(subset(fies, !is.na(head_occup_class)), aes(head_occup_class)) +
  geom_bar()
```

We take another look at the population of our dataset and we see that workers are the most
followed by the farmers, office, government and the least count are the professionals.

```{r}
ggplot(subset(fies, fies$inc_entrep != 0 & 
                !is.na(head_occup_class)), 
       aes(inc_entrep)) +
  geom_histogram(col=I("white")) +
  scale_x_continuous(
                     trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                200000, 
                                500000, 2000000),
                     limits = c(2000, 2500000)) +
  facet_wrap( ~ head_occup_class, ncol = 2)

#summary(fies$inc_work)

```
