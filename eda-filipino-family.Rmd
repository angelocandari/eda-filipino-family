---
title: "Typical Filipino"
output: 
  html_document:
    keep_md: true
    theme: spacelab
    highlight: monochrome
    css: style.css
---

# Introduction
Filipinos are hard working people but at the same time careless with their finances. It may seem odd that two contradicting behavours exists in a people. But, in the reality, they are slaves to their own traditions and social norms. One person would rather not eat for days just so that they could save enough money to buy an expensive bag. Or a whole year's savings could be spent over a weekend. Some would even complain of not having enough to buy a meal but would still be able to buy a pack of cigarettes.

## Objectives
In this article, I would like to know how Filipinos spend their money in relation to their income.

## Dataset Source
This dataset is from The Philippine Statistics Authority who conducts the 
Family Income and Expediture Survey (FEIS) every 3 years nationwide. This is 
from the 2015 most recent survey. The raw data was cleaned by Francis Paul 
Flores from his [kaggle.com/grosvenpaul](https://www.kaggle.com/grosvenpaul/family-income-and-expenditure/downloads/Family%20Income%20and%20Expenditure.csv).

# Getting a Feel of the Data
The Dataset contains 41,544 observations of Filipino Households from every 
Region of the country. It is comprised of 60 variables describing each family 
on their income, family description and expenditure.

```{r Load_data, message=FALSE, warning=FALSE}
library(readr)

fies <- read_csv("fies.csv")

names(fies)
```

Each variable is described accordingly. I changed them for the easier coding reference.

```{r renameCols}
# Rename Lables for easier reference.
names(fies) <- c("income", "region", "expense", "source", 
                 "agri_house", "exp_bread", "exp_rice", "exp_meat", 
                 "exp_seafood", "exp_fruit", "exp_veg", "exp_resto_hotel", 
                 "exp_alcoh", "exp_taba", "exp_clothe", "exp_house_water", 
                 "exp_rent", "exp_med", "exp_trans", "exp_comms", 
                 "exp_edu", "exp_misc", "exp_spec", "exp_farm",
                 "inc_entrep", "head_gender", "head_age", "head_stat", 
                 "head_educ", "head_job_bus", "head_occup", "head_workclass", 
                 "family_t", "family_n", "baby_n", "kid_n", 
                 "employed_n", "house_t", "roof_t", "wall_t", 
                 "house_area", "house_age", "bed_n", "house_tenure",
                 "toilet", "electric", "water_t", "tv_n", 
                 "DVD_n", "sterio_n", "ref_n", "wash_n", 
                 "aircon_n", "car_n", "tel_n", "cell_n",
                 "pc_n", "stove_n", "mboat_n", "mbike_n")

names(fies)
```

```{r incomeDistribution, message=FALSE, warning=FALSE}
library(ggplot2)

ggplot(fies, aes(income)) +
  geom_histogram()

```

There are lot of low-income and few high-income households that would make the graph skew to the left and stretch out to the right.

```{r incomeSummary}
summary(fies$income)
```

Doing a quick summary of the income, we see that the average income would be 247,556 Php annually.

```{r incomeLog10, echo=FALSE, message=FALSE, warning=FALSE}
library(scales)

set.seed(222)
fies_sam <- fies[sample(nrow(fies), 10000), ]

ggplot(fies, aes(income)) +
  geom_histogram(col = I("white")) +
  scale_x_continuous(
      trans = log10_trans(),
      breaks = c(10000, 25000, 70000,
                 150000, 247556, 400000,
                 1000000, 2000000)) +
  geom_vline(data = fies, 
             aes(xintercept = mean(fies$income)), 
             color = I("red"))
```

I wanted to see where this average exist in our distribution. Since the distribution is skewed by the large disparity in income, we transform the a histogram by log base 10. Think of it like we bringing the incomes bins closer together to get a better view on the distribution.

In the histogram. we find the average and mark in in a red line. We see that the average is slightly on the right side from the center. This tells us that the average is not the best representation to describe the whole distribution. In otherwords, 247k Php annual income is really high for most average Filipinos.

With this in mind, we divide the distribution according to working classes.

```{r groupByWorkclass, message=FALSE, warning=FALSE}
fies$head_occup <- factor(fies$head_occup)
fies$head_workclass <- factor(fies$head_workclass)

ggplot(fies, aes(income)) +
  geom_histogram() +
  scale_x_continuous(
                     trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                150000, 400000, 
                                1000000, 2000000)) +
  facet_wrap(~ head_workclass)
```

In this graph, we use the working class as defined by the survey. But this does not look familiar to us and is vague to us. So, I have decided to evaluate each household and group each according to the occupation of the head of the family.

```{r groupByCustomClass, message=FALSE, warning=FALSE}
library(stringr)
library(dplyr)

pro_class <- paste(c("managers", "medical", "dentist", "lawyer",
                     "architect", "supervisor", "trade", "education",
                     "chemist", "professionals", "scientist",
                     "justice", "Mechanical engineers", "director",
                     "accountant", "Chemical engineers", 
                     "Electrical Engineers", "Industrial engineers",
                     "designer", "singers", "television", "dancer",
                     "fashion", "marketing", "Civil engineers", "air",
                     "Computer programmers", "nurse", "Librarians",
                     "science", "therapist", "opticians", "Veter",
                     "pilots", "estate agents", "plant operators", 
                     "legislative"),
                   collapse = "|")

farm_class <- paste(c("farm", "fish", "growers", "gather", "duck",
                      "cultivat", "plant", "hunter", "village",
                      "practitioners", "healers", "diary", "animal"), 
                    collapse = "|")

work_class <- paste(c("workers", "carpenters", "welder", "helper", "clean",
                      "launder", "labor", "driver", "freight", "mechanics",
                      "mason", "porter", "waiter", "cook", "foremen",
                      "caretaker", "lineman", "varnish", "conductor",
                      "salesperson", "bookkeeper", "inspector", "undertaker", 
                      "loggers", "wood", "roofers", "cutter", "electricians",
                      "assembler", "builder", "metal",  "tanners", "garbage",
                      "repair", "prepare", "rigger", "vendors", "valuers",
                      "setters", "guides", "tasters", "potters", "preservers",
                      "textile", "fitters", "valets", "blasters", 
                      "humanitarian", "staff officers"), 
                    collapse = "|")

off_class <- paste(c("pawn", "buy", "baker", "maker", "tailor", "assistant",
                     "clerk", "engineering technicians", "operators",
                     "artists", "managers/managing proprietors", "insurance",
                     "educ", "principals", "secretaries", "general", 
                     "pharmacists", "commercial", "communications engineers",
                     "draftsmen", "instructors", "travel consultants",
                     "enlisted personnel"), 
                    collapse = "|")

fies$head_class <- with(fies,
                        ifelse(str_detect(head_workclass, "government"), 
                               "gov",
                        ifelse(grepl(work_class, head_occup, ignore.case = T),
                               "work",
                        ifelse(grepl(off_class, head_occup, ignore.case = T),
                               "off",
                        ifelse(grepl(farm_class, head_occup, ignore.case = T),
                               "farm",
                        ifelse(grepl(pro_class, head_occup, ignore.case = T),
                               "pro",
                               NA))))))
```

```{r Reveiw_class, warning=FALSE, paged.print=FALSE}

fies.occup <- fies %>%
  filter(is.na(fies$head_class)) %>%
  group_by(head_occup) %>%
  summarise(n= n(),
            income_mean = mean(income),
            income_median = median(income)) %>%
  arrange(desc(n))

fies.occup
```

The working classes that I have defined are as follows:

- *Professionals.* Jobs that usually requires higher education.
- *Office* Usually found in shops and offices.
- *Government.* Jobs in government.
- *Workers.* Jobs that usually pays low and does not require a degree.
- *Farmers.* Jobs that pertains to rural work. Agriculture, Fishing, etc.

These categories are based on my own classifications of how I see the working class and their overall mean income. I am ignoring the households that did not specify the occupation of the head of the family.

```{r summaryCustomClass }
tapply(fies$income, fies$head_class, summary)
```

```{r reveiwWorkerClass, message=FALSE, warning=FALSE}
fies.workers <- fies %>%
  filter(fies$head_class == "work") %>%
  select(head_occup, income, inc_entrep) %>%
  arrange(desc(income), head_occup)

fies.workers
```

```{r findingWaiterOutlier, message=FALSE, warning=FALSE}
subset(fies.workers, income == "5652261")
```

While reviewing my groupings, I noticed one outlier under the worker class. One Waiter was earning Php5,652,261 annually. This does not seem right to me so I took a deeper look and found out that *income* is actually the sum of salary income and income from their private business.

The Waiter was just earning Php544,810 from his job and the rest  was from his business, which was Php5,107,451. I reviewed my groupings again and made sure that I was grouping them according to their income salary from their occupation and not from their overall income.

```{r addIncomeFromWork}
fies$inc_work <- with(fies, income - inc_entrep)

# Check if there are no negative income from work.
head(table(sort(fies$inc_work)))
```

```{r summaryOfCustomGroups}
tapply(fies$inc_work, fies$head_class, summary)
```

```{r reviewProfessionals, message=FALSE, warning=FALSE}
fies.pro <- fies %>%
  filter(fies$head_class == "pro") %>%
  group_by(head_occup) %>%
  summarise(income_mean = mean(inc_work),
            income_median = median(inc_work),
            n= n()) %>%
  arrange(desc(income_mean))

fies.pro
```

```{r reviewOffice, message=FALSE, warning=FALSE}
fies.office <- fies %>%
  filter(fies$head_class == "off") %>%
  group_by(head_occup) %>%
  summarise(income_mean = mean(inc_work),
            income_median = median(inc_work),
            n= n()) %>%
  arrange(desc(income_mean))

fies.office
```

```{r reviewFarmer, message=FALSE, warning=FALSE}
fies.farm <- fies %>%
  filter(fies$head_class == "farm") %>%
  group_by(head_occup) %>%
  summarise(income_mean = mean(inc_work),
            income_median = median(inc_work),
            n= n()) %>%
  arrange(desc(income_mean))

fies.farm
```

```{r countWorkclass}
fies$head_class <- factor(fies$head_class, 
                          levels = c("pro", "gov", "off", "farm", "work"),
                          ordered = T)

ggplot(subset(fies, !is.na(head_class)), aes(head_class)) +
  geom_bar()
```

In our dataset, we generally have more workers than any of the other classes.
Professionals are the minority of the group.

## Income Source

```{r incomeDistributionByCustomClass, message=FALSE, warning=FALSE}
ggplot(subset(fies, income != 0 & 
                !is.na(head_class)), 
       aes(income)) +
  geom_histogram(col=I("white")) +
  scale_x_continuous(trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000),
                     limits = c(2000, 2500000)) +
  facet_wrap( ~ head_class, ncol = 2)  +
  geom_vline(data = subset(fies, !is.na(head_class)),
             aes(xintercept = mean(fies$income)),
             color = I("red"))
```

We go back to the overall income distribution but this time using our custom
work class. We add the average income Php247k and we see that some groups
are below the average line and other groups are above the average line.

```{r incomeFromSalaries, message=FALSE, warning=FALSE}
# We remove the households that does not specify occupation.
ggplot(subset(fies, inc_work != 0 & 
                !is.na(head_class)), 
       aes(inc_work)) +
  geom_histogram(col=I("white"), fill = I("#00CCFF")) +
  scale_x_continuous(trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000),
                     limits = c(2000, 2500000)) +
  scale_y_continuous(breaks = c(0, 500, 1000, 1500,
                               2000, 2500),
                     limits = c(0, 2500)) +
  facet_wrap( ~ head_class, ncol = 2)  +
  geom_vline(data = subset(fies, !is.na(head_class)),
             aes(xintercept = mean(fies$income)),
             color = I("red"))
```

If people relied from their salaries, the picture would generally look the same except for the office and workers, where salaries are more spread out to the left.

```{r expenseByCustomClass, message=FALSE, warning=FALSE}
ggplot(subset(fies, inc_entrep != 0 & 
                !is.na(head_class)), 
       aes(inc_entrep)) +
  geom_histogram(col=I("white"), fill = I("#82AF4C")) +
  scale_x_continuous(trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000),
                     limits = c(2000, 2500000)) +
  scale_y_continuous(breaks = c(0, 500, 1000, 1500,
                               2000, 2500),
                     limits = c(0, 2500)) +
  facet_wrap( ~ head_class, ncol = 2)  +
  geom_vline(data = subset(fies, !is.na(head_class)),
             aes(xintercept = mean(fies$income)),
             color = I("red"))
```

If people relied solely on income from their business, all of them are below
the Average line of the overall income population. 

These grouped histograms shows that Filipinos who works in offices and workers would commonly rely mostly from their salaries but would still have income from private business that would support their overall income.

```{r boxplotsIncomeSalaries}
ggplot(subset(fies, !is.na(head_class)), aes(head_class, inc_work)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, quantile(fies$inc_work, .98)))
```

```{r boxplotsIncomeBusiness}
ggplot(subset(fies, !is.na(head_class)), aes(head_class, inc_entrep)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, quantile(fies$inc_entrep, .98)))
```

Both graphs shows that professionals are heavily dependent on salaries. While most groups would treat their business as a secondary source of income, office employees and farmers would seem to have more profitable business than the rest of the groups.

```{r transformWideToLong}
library(tidyr)

fies$id <- seq_len(nrow(fies))

fies.n <- fies %>%
  filter(!is.na(fies$head_class)) %>%
  select(id, head_class, inc_entrep, inc_work) %>%
  gather(inc_type, inc, c(inc_work, inc_entrep)) %>%
  arrange(id)

fies.n
```

We would like to compare work income from business income to find out the
relationship. We transform the data from wide format to long format so that
we can graph the data in a frequency polygon.

```{r salaryVsBusiness, message=FALSE, warning=FALSE}
ggplot(fies.n, aes(inc, color = inc_type)) +
  geom_freqpoly(alpha =.5) +
  scale_x_continuous(trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000),
                     limits = c(2000, 2500000)) +
  facet_wrap(~ head_class, ncol = 2)
```

We see that farmers have both their salaries from business income at almost similar distribution with their salary income. Office Employees have income from Salaries higher than their business income. While workers would have a distribution that have a higher income from Salaries and income from business more spread out. Government employees and Professionals does not have a clear relationship between income from salaries business.

But this is not clear because we are mixing households with 2 sources of income (salary and Business) with the ones with only 1 source of income.

```{r}
fies.dual <- fies %>%
  filter(!is.na(head_class)) %>%
  filter(inc_work > 0 & inc_entrep > 0) %>%
  select(id, head_class, income, inc_work, inc_entrep) %>%
  mutate(prop_work = inc_work/income,
         prop_entrep = inc_entrep/income) %>%
  gather(inc_type, prop, c(prop_work, prop_entrep)) %>%
  select(id, head_class, inc_type, prop) %>%
  arrange(id)

fies.dual
```
```{r}
length(unique(fies.dual$id))
```

Out of the total 41,544 households, 23,897 have 2 sources of income. We extract these observations and mold the data to enable us to see where these income are coming from according to our work class.

```{r}
ggplot(fies.dual, aes(head_class, prop, fill = inc_type)) +
  geom_boxplot()
```

Households who have 2 sources income would rely more on their salary than they would their business. This is more so for Professionals, Government and Workers where they would get 75% of their income from their salary. While Office and Farmers would have their Business income producing at almost the same level from their Salary income.

## Spending Habits

```{r}
fies.w <- fies %>%
  filter(!is.na(head_class)) %>%
  select(id, head_class, income, expense)
```


```{r warning=FALSE}
ggplot(fies.w, aes(income, expense)) +
  geom_point(alpha = .2) +
  scale_x_continuous(limits = c(0, quantile(fies$income, .98))) +
  scale_y_continuous(limits = c(0, quantile(fies$expense, .98)))
```

We want to relate expense with their income and if we graph the relationship,
we see that as income increase, so does their expenses, which is obvious.

```{r}
ggplot(fies.w, aes(income, expense, color = head_class)) +
  geom_point(alpha = .2) +
  scale_x_continuous(limits = c(0, quantile(fies$income, .98))) +
  scale_y_continuous(limits = c(0, quantile(fies$expense, .98)))
```

If we look at the same graph but this time color-coded according to our custom
class, we see better which types of proffesions are having higher incomes. But
this is not really clear.

```{r}
ggplot(fies.w, aes(income, expense, color = head_class)) +
  geom_point(position = "jitter", alpha = .5, shape = 21) +
  scale_x_continuous(trans = log10_trans(), 
                     limits = c(15000, quantile(fies$income, .99)),
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000)) +
  scale_y_continuous(trans = log10_trans(), 
                     limits = c(15000, quantile(fies$expense, .99)),
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000))
```

```{r}
ggplot(fies.w, aes(income, expense, color = head_class)) +
  geom_point(position = "jitter", alpha = .5, shape = 21) +
  scale_x_continuous(trans = log10_trans(), 
                     limits = c(15000, quantile(fies$income, .98)),
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000)) +
  scale_y_continuous(trans = log10_trans(), 
                     limits = c(15000, quantile(fies$income, .98)),
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000)) +
  facet_wrap(~head_class)
```
 
 Splitting the graphs in a facet, it seems that all classes are resembling the
 same pattern where the more income they have the higher they would spend. This
 does not tell us anything new. And I get to thinking, what are they actually
 spending on? To answer that, we look at our available variables and see.
 
```{r}
names(fies)
head(fies)
```

I just realized that the *expense* is the total expense of food and not the total expense overall. The above graphs in this section are wrong. I correct this by adding all expenses under *expense_total*.

```{r}
fies.w.exp <- fies %>%
  filter(!is.na(head_class)) %>%
  mutate(expense_total = exp_bread + exp_rice + exp_meat + exp_seafood + 
           exp_fruit + exp_veg + exp_resto_hotel + exp_spec + exp_clothe +
           exp_alcoh + exp_taba + exp_house_water + exp_rent + exp_med +
           exp_farm + exp_edu + exp_comms + exp_trans + exp_misc) %>%
  mutate(exp_food = (exp_bread + exp_rice + exp_meat + exp_seafood + 
           exp_fruit + exp_veg) / expense_total,
         exp_lux = (exp_resto_hotel + exp_spec + exp_clothe +
           exp_alcoh + exp_taba) / expense_total,
         exp_house = (exp_house_water + exp_rent) / expense_total,
         exp_medi = exp_med / expense_total,
         exp_farms = exp_farm / expense_total,
         exp_educ = exp_edu / expense_total,
         exp_live = (exp_comms + exp_trans + exp_misc) / expense_total) %>%
  gather(cashflow, cash, c(exp_food, exp_lux, exp_house, exp_medi,
                           exp_farms, exp_educ, exp_live)) %>%
  select(id, head_class, cashflow, cash) %>%
  arrange(id)

names(fies.w.exp)
fies.w.exp$cashflow <- factor(fies.w.exp$cashflow)
fies.w.exp
```

```{r}
ggplot(fies.w.exp, aes(head_class, cash, fill = cashflow)) +
  geom_boxplot() 
```

This boxplots shows the proportion of each group expenses. It enables us to see what each goup are spending on and are prioritizing.

```{r}
fies %>%
  mutate(expense = exp_bread + exp_rice + exp_meat + exp_seafood + 
           exp_fruit + exp_veg + exp_resto_hotel + exp_spec + exp_clothe +
           exp_alcoh + exp_taba + exp_house_water + exp_rent + exp_med +
           exp_farm + exp_edu + exp_comms + exp_trans + exp_misc)

fies
```

```{r}
fies.n.exp <- fies %>%
  filter(!is.na(head_class)) %>%
  mutate(exp_food = exp_bread + exp_rice + exp_meat + exp_seafood + 
           exp_fruit + exp_veg,
         exp_lux = exp_resto_hotel + exp_spec + exp_clothe,
         exp_vice = exp_alcoh + exp_taba,
         exp_house = exp_house_water + exp_rent,
         exp_live = exp_comms + exp_trans + exp_misc) %>%
  gather(cashflow, cash, c(exp_food, exp_lux, exp_house, exp_vice, exp_med,
                           exp_farm, exp_edu, exp_live)) %>%
  select(id, head_class, income, cashflow, cash) %>%
  arrange(id)

fies.n.exp
```

```{r}
summary(fies.n.exp)
```

```{r}
ggplot(fies.n.exp, aes(income/8, cash, fill = cashflow, color = I("white"))) +
  geom_point(position = "jitter", alpha = .2, shape = 21) +
  scale_x_continuous(trans = log10_trans(), 
                     #limits = c(15000, quantile(fies.n.exp$income, .98)),
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000)) +
  scale_y_continuous(trans = log10_trans(), 
                     #limits = c(10, quantile(fies.n.exp$cash, .99)),
                     breaks = c(1000, 9000, 20000,
                                40000, 100000)) +
  facet_wrap(~head_class)
```

From the graph, it would seem Filipinos would tend to prioritize food above else regardless of working class. With the exception of the farmers, would still have vices and luxury items as part of their expenses.

```{r}
ggplot(fies.n.exp, aes(income/8, cash, fill = head_class, color = I("white"))) +
  geom_point(position = "jitter", alpha = .2, shape = 21) +
  scale_x_continuous(trans = log10_trans(), 
                     #limits = c(15000, quantile(fies.n.exp$income, .98)),
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000)) +
  scale_y_continuous(trans = log10_trans(), 
                     #limits = c(10, quantile(fies.n.exp$cash, .99)),
                     breaks = c(1000, 9000, 20000,
                                40000, 100000)) +
  facet_wrap(~cashflow)
```


```{r warning=FALSE}
ggplot(fies.n.exp, aes(income/8, cash, fill = cashflow, color = I("white"))) +
  geom_point(position = "jitter", alpha = .2, shape = 21) +
  scale_x_continuous(trans = log10_trans(), 
                     #limits = c(15000, quantile(fies.n.exp$income, .98)),
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000)) +
  scale_y_continuous(trans = log10_trans(), 
                     #limits = c(10, quantile(fies.n.exp$cash, .99)),
                     breaks = c(1000, 9000, 20000,
                                40000, 100000)) +
  facet_grid(head_class~cashflow)
```


AS income increases, so does their expenses. In all types of households, Filipinos would generally spend more housing, living, luxury items. Food expense would increase but it would level off at certain point. Education, Medical and Vices seems to be too spread out. This may well depend on other factors.

## Savings

```{r}
fies <- transform(fies, savings = income - expense)

fies.savings <- fies %>%
  filter(!is.na(head_class)) %>%
  select(id, head_class, income, expense, savings) %>%
  mutate(inc_sav_ratio = savings/income) %>%
  arrange(savings)

fies.savings
```

```{r}
ggplot(fies.savings, aes(income, inc_sav_ratio)) +
  geom_line() +
  scale_x_continuous(trans = log10_trans(), 
                   #limits = c(15000, quantile(fies.n.exp$income, .98)),
                   breaks = c(10000, 25000, 70000,
                              247556, 
                              500000, 2000000)) +
  coord_cartesian(ylim = c(-1, 1))
```

```{r}
ggplot(fies.savings, aes(income, inc_sav_ratio)) +
  geom_jitter(alpha = .1) +
  scale_x_continuous(trans = log10_trans(), 
                   #limits = c(15000, quantile(fies.n.exp$income, .98)),
                   breaks = c(10000, 25000, 70000,
                              247556, 
                              500000, 2000000)) +
  coord_cartesian(ylim = c(-.5, 1)) +
  facet_wrap(~head_class)
```