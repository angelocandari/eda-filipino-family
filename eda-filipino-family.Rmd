---
title: "Typical Filipino"
output: 
  html_document:
    keep_md: true
    theme: spacelab
    highlight: monochrome
    css: style.css
  html_notebook: 
    fig_width: 7
---

# Introduction
Filipinos are cheerful, resourceful and practical people. It is in our nature 
to make the best out a of any situation, no matter how hard it is. We get this 
from our strong family values and religious beliefs. However, our ideals are 
not always represented in  our actions especially when it comes to our 
financial priorities. I would always hear stories of parents working abroad for 
10 to 20 years and coming back to their families poorer than they were before 
they left.

## Objectives
In this article, I would like to find out if the spending habits and financial 
priorities change as thier income increases of a typical Filipino family.

## Dataset Source
This dataset is from The Philippine Statistics Authority who conducts the 
Family Income and Expediture Survey (FEIS) every 3 years nationwide. This is 
from the 2015 most recent survey. The raw data was cleaned by Francis Paul 
Flores from his [kaggle.com/grosvenpaul](https://www.kaggle.com/grosvenpaul/family-income-and-expenditure/downloads/Family%20Income%20and%20Expenditure.csv).

# Getting a Feel of the Data
The Dataset contains 41,544 observations of Filipino Households from every 
Region of the country. It is comprised of 60 variables describing each family 
on their income, family description and expenditure.

```{r message=FALSE, warning=FALSE}
library(readr)

fies <- read_csv("fies.csv")

# Rename Lables for easier reference.
names(fies) <- c("income", "region", "expense", "source", 
                 "agri_house", "exp_bread", "exp_rice", "exp_meat", 
                 "exp_seafood", "exp_fruit", "exp_veg", "exp_resto_hotel", 
                 "exp_alcoh", "exp_taba", "exp_clothe", "exp_house_water", 
                 "exp_rent", "exp_med", "exp_trans", "exp_comms", 
                 "exp_edu", "exp_misc", "exp_spec", "exp_farm",
                 "inc_entrep", "head_gender", "head_age", "head_stat", 
                 "head_educ", "head_job_bus", "head_occup", "head_workclass", 
                 "family_t", "family_n", "kids_n", "young_n", 
                 "employed_n", "house_t", "roof_t", "wall_t", 
                 "house_area", "house_age", "bed_n", "house_tenure",
                 "toilet", "electric", "water_t", "tv_n", 
                 "DVD_n", "sterio_n", "ref_n", "wash_n", 
                 "aircon_n", "car_n", "tel_n", "cell_n",
                 "pc_n", "stove_n", "mboat_n", "mbike_n")
```

There are 60 variables in this dataset and are not code-friendly. First thing 
to do is rename each column key. A detailed desciption of each column is 
documented on a separate txt file for your reference.

```{r}
names(fies)
```

## Income Distribution

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)

ggplot(fies, aes(income)) +
  geom_histogram()

```

It's no surprise that income per household is skewed to the left, where there is
more poor families and few rich people with dramatic outlying incomes.

```{r}
summary(fies$income)
```

Doing a quick summary of the income, we see that the average income of each
household is 247,556 Php annually. But this is skewed because of the maximum
income of 11 mill Php of the super rich.

## Why Averaging Everything is just Lazy

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(scales)
set.seed(222)
fies_sam <- fies[sample(nrow(fies), 10000), ]
ggplot(fies_sam, aes(income)) +
  geom_histogram(col = I("white")) +
  scale_x_continuous(
      trans = log10_trans(),
      breaks = c(10000, 25000, 70000,
                 150000, 247556, 400000,
                 1000000, 2000000)) +
  geom_vline(data = fies, 
             aes(xintercept = mean(fies$income)), 
             color = I("red"))
```

We transform the histogram to adjust the power of magnitude of each income and
as a result we can see a beautiful normal distribution. To understand why we use
log, imagine that we made the x axis points closer together so that we can see
see the distribution more clearly.

The problem with relying on averages is that it is heavily influenced by 
outliers. Php 247,556 in the graph is far from the center, which makes it a poor 
representative of the distribution.

The Rich are really rich at 11 mill Php  and the Poor are really poor with only 
11,285 Php of annual income.

In addition, this average is of the whole population. We can't do that because,
for some people, 247k is small while other it is very big. So, we facet the 
graph according to different groups or work classes.

## Grouped by Working Class according to Survey

```{r echo=FALSE, message=FALSE, warning=FALSE}
fies$head_occup <- factor(fies$head_occup)
fies$head_workclass <- factor(fies$head_workclass)

ggplot(fies, aes(income)) +
  geom_histogram() +
  scale_x_continuous(
                     trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                150000, 400000, 
                                1000000, 2000000)) +
  facet_wrap(~ head_workclass)
```

In this graph, we use the work class determined by the survey. But this is not 
really telling us anything especially that the categories are vague and are not 
familiar. The needs a little bit of cleaning.

## We make our own Groups

```{r message=FALSE, warning=FALSE}
library(stringr)
library(dplyr)

pro_class <- paste(c("managers", "medical", "dentist", "lawyer",
                     "architect", "supervisor", "trade", "education",
                     "chemist", "professionals", "scientist",
                     "justice", "Mechanical engineers", "director",
                     "accountant", "Chemical engineers", 
                     "Electrical Engineers", "Industrial engineers",
                     "designer", "singers", "television", "dancer",
                     "fashion", "marketing", "Civil engineers", "air",
                     "Computer programmers", "nurse", "Librarians",
                     "science", "therapist", "opticians", "Veter",
                     "pilots", "estate agents", "plant operators"),
                   collapse = "|")

farm_class <- paste(c("farm", "fish", "growers", "gather", "duck",
                      "cultivat", "plant", "hunter", "village",
                      "practitioners", "healers", "diary", "animal"), 
                    collapse = "|")

work_class <- paste(c("workers", "carpenters", "welder", "helper", "clean",
                      "launder", "labor", "driver", "freight", "mechanics",
                      "mason", "porter", "waiter", "cook", "foremen",
                      "caretaker", "lineman", "varnish", "conductor",
                      "salesperson", "bookkeeper", "inspector", "undertaker", 
                      "loggers", "wood", "roofers", "cutter", "electricians",
                      "assembler", "builder", "metal",  "tanners", "garbage",
                      "repair", "prepare", "rigger", "vendors", "valuers",
                      "setters", "guides", "tasters", "potters"), 
                    collapse = "|")

off_class <- paste(c("pawn", "buy", "baker", "maker", "tailor", "assistant",
                     "clerk", "engineering technicians", "operators",
                     "artists", "managers/managing proprietors", "insurance",
                     "educ", "principals", "secretaries", "general", 
                     "pharmacists"), 
                    collapse = "|")

fies$head_class <- with(fies,
                        ifelse(str_detect(head_workclass, "government"), 
                               "gov",
                        ifelse(grepl(work_class, head_occup, ignore.case = T),
                               "work",
                        ifelse(grepl(off_class, head_occup, ignore.case = T),
                               "off",
                        ifelse(grepl(farm_class, head_occup, ignore.case = T),
                               "farm",
                        ifelse(grepl(pro_class, head_occup, ignore.case = T),
                               "pro",
                               NA))))))
```

## We got to Catch them All

```{r warning=FALSE, paged.print=FALSE}

fies.occup <- fies %>%
  filter(is.na(fies$head_class)) %>%
  group_by(head_occup) %>%
  summarise(n= n(),
            income_mean = mean(income),
            income_median = median(income)) %>%
  arrange(desc(n))

fies.occup
```

I decided to evaluate each occupation of the head of the family and manually 
group each household according to the following working class:

- *Professionals.* Jobs that usually requires higher education.
- *Office* Usually found in shops and offices of goods.
- *Government.* Jobs in government.
- *Workers.* Jobs that usually pays low and does not require a degree.
- *Farmers.* Jobs that pertains to rural work. Agriculture, Fishing, etc.

I am basing the categories based on my own classifications of how I see the
working class and their overall mean income.

```{r}
tapply(fies$income, fies$head_class, summary)
```

## A Millioniare Waiter

I review each working class and see what I can further refine. My goal is to
segment as much as I can to emphasize the division among the working classes
and at the same time being fair with my evaluation of the different jobs.

```{r message=FALSE, warning=FALSE, paged.print=TRUE}
fies.workers <- fies %>%
  filter(fies$head_class == "work") %>%
  select(head_occup, income, inc_entrep) %>%
  arrange(desc(income), head_occup)

fies.workers
```

```{r message=FALSE, warning=FALSE}
subset(fies.workers, income == "5652261")
```

I then checked the worker class and noticed some interesting outliers in the
group. The one that stood out is a Waiter job who is earning Php5,652,261
annually. This does not seem right to me and I took a deeper look and found out
that income is the sum of their income from their jobs and their business. Since
we are categorizing each as income according to their working class, we
re-evaluate by deriving the income from their jobs from their total income.

Subtracting the income from business from the total income, the Waiter was 
actually earning Php544,810 annually from his job and Php5,107,451 from his 
business.

## We just want the Income from their Jobs

```{r}
fies$inc_work <- with(fies, income - inc_entrep)

head(table(sort(fies$inc_work)))
```

```{r}
tapply(fies$inc_work, fies$head_class, summary)
```

## Reveiwing the Professionals

```{r message=FALSE, warning=FALSE}
fies.pro <- fies %>%
  filter(fies$head_class == "pro") %>%
  group_by(head_occup) %>%
  summarise(income_mean = mean(inc_work),
            income_median = median(inc_work),
            n= n()) %>%
  arrange(desc(income_mean))

fies.pro
```

## Reviewing the Office Employees

```{r message=FALSE, warning=FALSE, paged.print=TRUE}
fies.office <- fies %>%
  filter(fies$head_class == "off") %>%
  group_by(head_occup) %>%
  summarise(income_mean = mean(inc_work),
            income_median = median(inc_work),
            n= n()) %>%
  arrange(desc(income_mean))

fies.office
```

## Reviewing the Farmers

```{r message=FALSE, warning=FALSE}
fies.farm <- fies %>%
  filter(fies$head_class == "farm") %>%
  group_by(head_occup) %>%
  summarise(income_mean = mean(inc_work),
            income_median = median(inc_work),
            n= n()) %>%
  arrange(desc(income_mean))

fies.farm
```

## See what happens when you just Average

```{r message=FALSE, warning=FALSE}
ggplot(subset(fies, income != 0 & 
                !is.na(head_class)), 
       aes(income)) +
  geom_histogram(col=I("white")) +
  scale_x_continuous(trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000),
                     limits = c(2000, 2500000)) +
  facet_wrap( ~ head_class, ncol = 2)  +
  geom_vline(data = subset(fies, !is.na(head_class)),
             aes(xintercept = mean(fies$income)),
             color = I("red"))
```

We go back to the overall income distribution but this time using our working
class categories. We add the average income Php247k and we see that some groups
are below the average line and other groups are above the average line.

## Income from Salaries

```{r message=FALSE, warning=FALSE}
ggplot(subset(fies, inc_work != 0 & 
                !is.na(head_class)), 
       aes(inc_work)) +
  geom_histogram(col=I("white"), fill = I("#00CCFF")) +
  scale_x_continuous(trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000),
                     limits = c(2000, 2500000)) +
  scale_y_continuous(breaks = c(0, 500, 1000, 1500,
                               2000, 2500),
                     limits = c(0, 2500)) +
  facet_wrap( ~ head_class, ncol = 2)  +
  geom_vline(data = subset(fies, !is.na(head_class)),
             aes(xintercept = mean(fies$income)),
             color = I("red"))
```

If people relied from their salaries, the picture is the same. Farmers, Office
and Workers are below the average line while Gov Employees and Professionals
are above the average line.

```{r message=FALSE, warning=FALSE}
ggplot(subset(fies, inc_entrep != 0 & 
                !is.na(head_class)), 
       aes(inc_entrep)) +
  geom_histogram(col=I("white"), fill = I("#82AF4C")) +
  scale_x_continuous(trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000),
                     limits = c(2000, 2500000)) +
  scale_y_continuous(breaks = c(0, 500, 1000, 1500,
                               2000, 2500),
                     limits = c(0, 2500)) +
  facet_wrap( ~ head_class, ncol = 2)  +
  geom_vline(data = subset(fies, !is.na(head_class)),
             aes(xintercept = mean(fies$income)),
             color = I("red"))
```

If people relied solely on income from their business, All of them are below
the Average line. But the graphs are different somehow but it is not clear from
this view.

```{r}
library(tidyr)
fies$id <- seq_len(nrow(fies))

fies.n <- fies %>%
  filter(!is.na(fies$head_class)) %>%
  select(id, head_class, income, inc_entrep, inc_work, expense) %>%
  gather(inc_type, inc, c(inc_work, inc_entrep)) %>%
  gather(cashflow, cash, c(income, expense))

head(fies.n)
  
```

```{r message=FALSE, warning=FALSE}
ggplot(subset(fies, inc_entrep != 0 & 
                !is.na(head_class)), 
       aes(inc_entrep)) +
  geom_histogram(col=I("white"), fill = I("#82AF4C")) +
  scale_x_continuous(trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000),
                     limits = c(2000, 2500000)) +
  scale_y_continuous(breaks = c(0, 500, 1000, 1500,
                               2000, 2500),
                     limits = c(0, 2500)) +
  facet_wrap( ~ head_class, ncol = 2)  +
  geom_vline(data = subset(fies, !is.na(head_class)),
             aes(xintercept = mean(fies$income)),
             color = I("red"))
```

```{r}
ggplot(fies.n, aes(inc, color = inc_type)) +
  geom_freqpoly(alpha =.5) +
  scale_x_continuous(trans = log10_trans(), 
                     breaks = c(10000, 25000, 70000,
                                247556, 
                                500000, 2000000),
                     limits = c(2000, 2500000)) +
  facet_wrap(~ head_class, ncol = 2)
```